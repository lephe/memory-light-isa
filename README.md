# ASM 2017

This repository consists of two independent programs: the assembly language
compiler (`/compiler`) that does all the translation to binary code, and the
emulator (`/emu`) that emulates and debugs compiled programs.

## Language description

The specification of the assembly language (`.s` files) can be found in the
`subject/isa2017v1.pdf` file. It is a bit unwieldy to use (for instance, there
are four `add`-type mnemonics that differ in the type and number of arguments),
so the compiler supports a variant (`.ps` files) with simplified commands (such
as a unique overloaded `add` mnemonic).


## Compiler (`/compiler`)

### Usage

Use `compileme -h` to display help.

Basic use is `python -m compiler -h (--stdout | --output=file) (-m|-t|-b) file.ps`. The `--stdout` option (default) will print the program, whereas `--output=file` will write in the file the output. The three options `-m`, `-t` and `-b` specify the back-end. `-m` print mnemonics, `-t` print the teacher (text) version of the program, and `-b` the binary version.

There is a optional switch, `--huffman`, It will change the binary and teacher output in accordance to a Huffman-tree generated by accounting the number of each mnemonics.

### Troubleshooting

Please add an issue if you find any bugs.



## Emulator (`/emu`)

Building the emulator consists in running `make` in the `/emu` directory. See
`/doc/emu_troubleshooting.md` if anything goes wrong at compile time or at
execution time (compile errors, bad rendering, ...).

The emulator is invoked with a command of the following form:

```
$ ./emu [-r|-d] [-g] <binary> [options...]
```

It expects a *binary* file. Such files can be produced by invoking the compiler
with the `-b` switch. Text files will be accepted but produce irrelevant
assembler; providing text files to the emulator is an error.

The emulator supports three options that affect the execution mode:
- `-r` or `--run` makes the emulator run quickly without printing any
  information. When the execution ends, the processor state is shown on the
  standard output. (default)
- `-d` or `--debug` enables the debugger. The debugger provides fine-grained
  control over execution: step-by-step execution, breakpoints, disassembling
  and register/memory monitoring.
- `-g` or `--graphical`. In addition to `-r` or `-d`, enables graphical I/O
  using an SDL layer.

Other options are provided to customize the memory geometry; see
`/doc/emu_memory_layout.md` for more information. (For most programs these
options need not be used.)

The debugger runs an ncurses interface. The minimal usable terminal geometry is
96 × 32. The recommended geometry is anything beyond 128 × 40; on smaller
terminals some information (such as instruction addresses) are hidden so that
everything fits on the screen. The debugger is controlled by a command-line
which has an integrated help. Please refer to this help for details about how
to use the debugger.
